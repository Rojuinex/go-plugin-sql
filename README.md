## Building

Go Plugins are currently only supported on Linux / MacOS

    make


## Testing

### Create docker container

    docker run --name testmysql -e MYSQL_ALLOW_EMPTY_PASSWORD=yes -p 3306:3306  -d mysql

### Create database

    CREATE DATABASE `testdb` /*!40100 DEFAULT CHARACTER SET latin1 */;

### Create table

    CREATE TABLE `testtable` (
      `ID` int(11) NOT NULL AUTO_INCREMENT,
      `Name` varchar(45) DEFAULT NULL,
      PRIMARY KEY (`ID`),
      UNIQUE KEY `ID_UNIQUE` (`ID`)
    ) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;

### Insert records

    INSERT INTO `testdb`.`testtable` (`Name`) VALUES ("Bob");
    INSERT INTO `testdb`.`testtable` (`Name`) VALUES ("Saget");

### Execute
    ./go-plugin-sql


## Error Log

    runtime: bad pointer in frame runtime.selectgo at 0xc420050d70: 0x2
    fatal error: invalid pointer found on stack
    
    runtime stack:
    runtime.throw(0x5286bbe, 0x1e)
    	/usr/local/go/src/runtime/panic.go:616 +0x81 fp=0x700003bca708 sp=0x700003bca6e8 pc=0x502add1
    runtime.adjustpointers(0xc420050cf0, 0x700003bca800, 0x700003bcabc0, 0x52e6768, 0x53a1540)
    	/usr/local/go/src/runtime/stack.go:592 +0x23e fp=0x700003bca778 sp=0x700003bca708 pc=0x504084e
    runtime.adjustframe(0x700003bcaad0, 0x700003bcabc0, 0x53a1540)
    	/usr/local/go/src/runtime/stack.go:663 +0x325 fp=0x700003bca830 sp=0x700003bca778 pc=0x5040b95
    runtime.gentraceback(0xffffffffffffffff, 0xffffffffffffffff, 0x0, 0xc420001b00, 0x0, 0x0, 0x7fffffff, 0x528e828, 0x700003bcabc0, 0x0, ...)
    	/usr/local/go/src/runtime/traceback.go:310 +0x12d3 fp=0x700003bcab38 sp=0x700003bca830 pc=0x5049a33
    runtime.copystack(0xc420001b00, 0x1000, 0x1)
    	/usr/local/go/src/runtime/stack.go:891 +0x26e fp=0x700003bcacf0 sp=0x700003bcab38 pc=0x504167e
    runtime.newstack()
    	/usr/local/go/src/runtime/stack.go:1063 +0x310 fp=0x700003bcae80 sp=0x700003bcacf0 pc=0x5041a90
    runtime.morestack()
    	/usr/local/go/src/runtime/asm_amd64.s:480 +0x89 fp=0x700003bcae88 sp=0x700003bcae80 pc=0x504f9c9
    
    goroutine 9 [copystack]:
    runtime.heapBitsSetType(0xc4200e40c0, 0x60, 0x60, 0x40e8c00)
    	/usr/local/go/src/runtime/mbitmap.go:864 +0x652 fp=0xc420050b18 sp=0xc420050b10 pc=0x50154b2
    runtime.mallocgc(0x60, 0x40e8c00, 0x1, 0x0)
    	/usr/local/go/src/runtime/malloc.go:740 +0x588 fp=0xc420050bb8 sp=0xc420050b18 pc=0x5012298
    runtime.newobject(0x40e8c00, 0x0)
    	/usr/local/go/src/runtime/malloc.go:839 +0x38 fp=0xc420050be8 sp=0xc420050bb8 pc=0x50128a8
    runtime.acquireSudog(0xc420080288)
    	/usr/local/go/src/runtime/proc.go:330 +0x2b4 fp=0xc420050c58 sp=0xc420050be8 pc=0x502cb54
    runtime.selectgo(0xc420045680, 0xc42001c240)
    	/usr/local/go/src/runtime/select.go:366 +0xb22 fp=0xc420050e30 sp=0xc420050c58 pc=0x503a2f2
    github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc420080240, 0xc4200de000, 0xc42001c300)
    	/Users/rojuinex/go/src/github.com/go-sql-driver/mysql/connection_go18.go:182 +0xdf fp=0xc420050fc8 sp=0xc420050e30 pc=0x51f823f
    runtime.goexit()
    	/usr/local/go/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc420050fd0 sp=0xc420050fc8 pc=0x5052371
    created by github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher
    	/Users/rojuinex/go/src/github.com/go-sql-driver/mysql/connection_go18.go:179 +0xd6
    
    goroutine 1 [runnable]:
    github.com/go-sql-driver/mysql.(*mysqlConn).readResultOK(0xc4200de000, 0x15, 0xc4200e8004, 0x0, 0xc4200e8000, 0xc420065648)
    	/Users/rojuinex/go/src/github.com/go-sql-driver/mysql/packets.go:498 +0x502 fp=0xc4200655f0 sp=0xc4200655e8 pc=0x51ecd92
    github.com/go-sql-driver/mysql.handleAuthResult(0xc4200de000, 0xc4200141e0, 0x14, 0x14, 0x0, 0x0)
    	/Users/rojuinex/go/src/github.com/go-sql-driver/mysql/driver.go:149 +0x2f fp=0xc420065658 sp=0xc4200655f0 pc=0x51e322f
    github.com/go-sql-driver/mysql.MySQLDriver.Open(0xc4200141c0, 0x20, 0x5011b76, 0x420ed18, 0x110, 0x110)
    	/Users/rojuinex/go/src/github.com/go-sql-driver/mysql/driver.go:114 +0x3dc fp=0xc4200657f8 sp=0xc420065658 pc=0x51e2cfc
    github.com/go-sql-driver/mysql.(*MySQLDriver).Open(0x419e1b8, 0xc4200141c0, 0x20, 0x0, 0xc4200658f8, 0x501201d, 0xc4200dc000)
    	<autogenerated>:1 +0x48 fp=0xc420065838 sp=0xc4200657f8 pc=0x51f9838
    database/sql.dsnConnector.Connect(0xc4200141c0, 0x20, 0x52aafc0, 0x419e1b8, 0x52af560, 0xc420016078, 0x0, 0x0, 0x0, 0xc420010000)
    	/usr/local/go/src/database/sql/sql.go:600 +0x45 fp=0xc420065880 sp=0xc420065838 pc=0x50c7f15
    database/sql.(*dsnConnector).Connect(0xc42000c380, 0x52af560, 0xc420016078, 0xc420065998, 0x501201d, 0xc4200107a0, 0x10)
    	<autogenerated>:1 +0x73 fp=0xc4200658e0 sp=0xc420065880 pc=0x50d6e43
    database/sql.(*DB).conn(0xc4200ce140, 0x52af560, 0xc420016078, 0xc420065b01, 0x50c83c9, 0x52ac620, 0xc42000c380)
    	/usr/local/go/src/database/sql/sql.go:1103 +0x131 fp=0xc420065ad0 sp=0xc4200658e0 pc=0x50c9ef1
    database/sql.(*DB).PingContext(0xc4200ce140, 0x52af560, 0xc420016078, 0x52aafc0, 0x419e1b8)
    	/usr/local/go/src/database/sql/sql.go:694 +0x91 fp=0xc420065b60 sp=0xc420065ad0 pc=0x50c8681
    database/sql.(*DB).Ping(0xc4200ce140, 0x5, 0xc4200141c0)
    	/usr/local/go/src/database/sql/sql.go:712 +0x46 fp=0xc420065b98 sp=0xc420065b60 pc=0x50c8886
    github.com/Rojuinex/go-plugin-sql/plugins/sql-provider.(*SqlProvider).openDB(0x53b7570, 0x0, 0x0)
    	/Users/rojuinex/go/src/github.com/Rojuinex/go-plugin-sql/plugins/sql-provider/main.go:43 +0x27c fp=0xc420065cb8 sp=0xc420065b98 pc=0x51fa56c
    github.com/Rojuinex/go-plugin-sql/plugins/sql-provider.(*SqlProvider).GetData(0x53b7570, 0x0, 0x0, 0x0, 0x0, 0x0)
    	/Users/rojuinex/go/src/github.com/Rojuinex/go-plugin-sql/plugins/sql-provider/main.go:55 +0x33a fp=0xc420065d60 sp=0xc420065cb8 pc=0x51fa94a
    main.main()
    	/Users/rojuinex/go/src/github.com/Rojuinex/go-plugin-sql/main.go:60 +0x27a fp=0xc420065f88 sp=0xc420065d60 pc=0x40b430a
    runtime.main()
    	/usr/local/go/src/runtime/proc.go:198 +0x212 fp=0xc420065fe0 sp=0xc420065f88 pc=0x402cb22
    runtime.goexit()
    	/usr/local/go/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc420065fe8 sp=0xc420065fe0 pc=0x4053451
    
    goroutine 2 [force gc (idle)]:
    runtime.gopark(0x40f8438, 0x4181d40, 0x40f1def, 0xf, 0x40f8314, 0x1)
    	/usr/local/go/src/runtime/proc.go:291 +0x11a fp=0xc420042768 sp=0xc420042748 pc=0x402cf7a
    runtime.goparkunlock(0x4181d40, 0x40f1def, 0xf, 0x14, 0x1)
    	/usr/local/go/src/runtime/proc.go:297 +0x5e fp=0xc4200427a8 sp=0xc420042768 pc=0x402d02e
    runtime.forcegchelper()
    	/usr/local/go/src/runtime/proc.go:248 +0xcc fp=0xc4200427e0 sp=0xc4200427a8 pc=0x402cdbc
    runtime.goexit()
    	/usr/local/go/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc4200427e8 sp=0xc4200427e0 pc=0x4053451
    created by runtime.init.4
    	/usr/local/go/src/runtime/proc.go:237 +0x35
    
    goroutine 3 [GC sweep wait]:
    runtime.gopark(0x40f8438, 0x4181e20, 0x40f198b, 0xd, 0x401f014, 0x1)
    	/usr/local/go/src/runtime/proc.go:291 +0x11a fp=0xc420042f60 sp=0xc420042f40 pc=0x402cf7a
    runtime.goparkunlock(0x4181e20, 0x40f198b, 0xd, 0x14, 0x1)
    	/usr/local/go/src/runtime/proc.go:297 +0x5e fp=0xc420042fa0 sp=0xc420042f60 pc=0x402d02e
    runtime.bgsweep(0xc420072000)
    	/usr/local/go/src/runtime/mgcsweep.go:52 +0xa3 fp=0xc420042fd8 sp=0xc420042fa0 pc=0x401f093
    runtime.goexit()
    	/usr/local/go/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc420042fe0 sp=0xc420042fd8 pc=0x4053451
    created by runtime.gcenable
    	/usr/local/go/src/runtime/mgc.go:216 +0x58
    
    goroutine 4 [finalizer wait]:
    runtime.gopark(0x40f8438, 0x419e128, 0x40f1bf9, 0xe, 0x14, 0x1)
    	/usr/local/go/src/runtime/proc.go:291 +0x11a fp=0xc420043718 sp=0xc4200436f8 pc=0x402cf7a
    runtime.goparkunlock(0x419e128, 0x40f1bf9, 0xe, 0x14, 0x1)
    	/usr/local/go/src/runtime/proc.go:297 +0x5e fp=0xc420043758 sp=0xc420043718 pc=0x402d02e
    runtime.runfinq()
    	/usr/local/go/src/runtime/mfinal.go:175 +0xad fp=0xc4200437e0 sp=0xc420043758 pc=0x401613d
    runtime.goexit()
    	/usr/local/go/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc4200437e8 sp=0xc4200437e0 pc=0x4053451
    created by runtime.createfing
    	/usr/local/go/src/runtime/mfinal.go:156 +0x62
    
    goroutine 5 [select]:
    runtime.gopark(0x528ea70, 0x0, 0x5280781, 0x6, 0x18, 0x1)
    	/usr/local/go/src/runtime/proc.go:291 +0x126 fp=0xc420043d30 sp=0xc420043d10 pc=0x502c776
    runtime.selectgo(0xc420043f38, 0xc42001c1e0)
    	/usr/local/go/src/runtime/select.go:392 +0xe96 fp=0xc420043f08 sp=0xc420043d30 pc=0x503a666
    database/sql.(*DB).connectionOpener(0xc4200ce140, 0x52af520, 0xc420020140)
    	/usr/local/go/src/database/sql/sql.go:935 +0x117 fp=0xc420043fc8 sp=0xc420043f08 pc=0x50c9717
    runtime.goexit()
    	/usr/local/go/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc420043fd0 sp=0xc420043fc8 pc=0x5052371
    created by database/sql.OpenDB
    	/usr/local/go/src/database/sql/sql.go:634 +0x182
    
    goroutine 6 [select]:
    runtime.gopark(0x528ea70, 0x0, 0x5280781, 0x6, 0x18, 0x1)
    	/usr/local/go/src/runtime/proc.go:291 +0x126 fp=0xc420044520 sp=0xc420044500 pc=0x502c776
    runtime.selectgo(0xc420044738, 0xc420080060)
    	/usr/local/go/src/runtime/select.go:392 +0xe96 fp=0xc4200446f8 sp=0xc420044520 pc=0x503a666
    database/sql.(*DB).connectionResetter(0xc4200ce140, 0x52af520, 0xc420020140)
    	/usr/local/go/src/database/sql/sql.go:948 +0x128 fp=0xc4200447c8 sp=0xc4200446f8 pc=0x50c9878
    runtime.goexit()
    	/usr/local/go/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc4200447d0 sp=0xc4200447c8 pc=0x5052371
    created by database/sql.OpenDB
    	/usr/local/go/src/database/sql/sql.go:635 +0x1b8
